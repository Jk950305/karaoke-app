{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/jonkim/Desktop/TestApp/Karaoke/client/src/components/Karaoke.jsx\";\nimport FilenameLabel from './FilenameLabel.jsx';\nimport TrackControls from './TrackControls.jsx';\nimport ErrorAlert from './ErrorAlert.jsx';\n\nconst EventEmitter = require('events').EventEmitter;\n\nconst React = require('react');\n\nconst AudioPlayer = require('./../lib/AudioPlayer');\n\nclass Karaoke extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.callApi = async () => {\n      const response = await fetch('/api/files');\n      const body = await response.json();\n      if (response.status !== 200) throw Error(body.message);\n      return body;\n    };\n\n    this.getMusic = async e => {\n      e.preventDefault();\n      var filename = e.target.outerText;\n      const response = await fetch('/api/mp3?=' + filename, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          post: this.state.post\n        })\n      });\n      const body = await response.text();\n      console.log(body);\n      this.setState({\n        responseToPost: body\n      });\n    };\n\n    this.state = {\n      action: 'stop',\n      duration: undefined,\n      error: undefined,\n      filename: undefined,\n      pitch: 1.0,\n      key: 0,\n      simpleFilter: undefined,\n      status: [],\n      t: 0,\n      tempo: 1.0,\n      response: [],\n      post: '',\n      responseToPost: ''\n    };\n    this.emitter = new EventEmitter();\n    this.emitter.on('state', state => this.setState(state));\n    this.emitter.on('status', status => {\n      if (status === 'Done!') {\n        this.setState({\n          status: []\n        });\n      } else {\n        this.setState({\n          status: this.state.status.concat(status)\n        });\n      }\n    });\n    this.emitter.on('stop', () => this.stop());\n    this.audioPlayer = new AudioPlayer({\n      emitter: this.emitter,\n      pitch: this.state.pitch,\n      tempo: this.state.tempo\n    });\n    this.inputRef = React.createRef();\n    this.file_location = \"\";\n  }\n\n  play() {\n    if (this.state.action !== 'play') {\n      this.audioPlayer.play();\n      this.setState({\n        action: 'play'\n      });\n    }\n  }\n\n  pause() {\n    if (this.state.action === 'play') {\n      this.audioPlayer.pause();\n      this.setState({\n        action: 'pause'\n      });\n    }\n  }\n\n  stop() {\n    this.pause();\n    this.audioPlayer.seekPercent(0);\n    this.setState({\n      action: 'stop',\n      t: 0\n    });\n  }\n\n  handleFileChange(e) {\n    if (e.target.files.length > 0) {\n      this.stop();\n      this.emitter.emit('status', 'Reading file...');\n      this.emitter.emit('state', {\n        error: undefined,\n        filename: undefined\n      }); // http://stackoverflow.com/q/4851595/786644\n\n      const filename = e.target.value.replace('C:\\\\fakepath\\\\', '');\n      this.emitter.emit('state', {\n        filename\n      });\n      const file = e.target.files[0];\n      this.file_location = URL.createObjectURL(file);\n      const reader = new FileReader();\n      reader.readAsArrayBuffer(file);\n\n      reader.onload = async event => {\n        this.emitter.emit('status', 'Playing file...');\n        let buffer;\n\n        try {\n          buffer = await this.audioPlayer.decodeAudioData(event.target.result);\n        } catch (err) {\n          this.emitter.emit('state', {\n            error: {\n              message: err.message,\n              type: 'Decoding error'\n            }\n          });\n          return;\n        }\n\n        this.file_location = filename;\n        this.audioPlayer.setBuffer(buffer);\n        this.play();\n      };\n    }\n  } //https://prgomez.com/why-do-re-mi/\n\n\n  getPitchValue(val) {\n    var num = 0;\n    var s_var = val >= 0 ? parseInt(val) : 12 + parseInt(val);\n\n    switch (s_var) {\n      case 0:\n        num = 1;\n        break;\n\n      case 1:\n        num = 1.059;\n        break;\n\n      case 2:\n        num = 1.122;\n        break;\n\n      case 3:\n        num = 1.189;\n        break;\n\n      case 4:\n        num = 1.26;\n        break;\n\n      case 5:\n        num = 1.335;\n        break;\n\n      case 6:\n        num = 1.414;\n        break;\n\n      case 7:\n        num = 1.498;\n        break;\n\n      case 8:\n        num = 1.587;\n        break;\n\n      case 9:\n        num = 1.682;\n        break;\n\n      case 10:\n        num = 1.782;\n        break;\n\n      case 11:\n        num = 1.888;\n        break;\n\n      case 12:\n        num = 2;\n        break;\n\n      default:\n        num = 1;\n        break;\n    }\n\n    const pitch = val >= 0 ? num : num / 2;\n    return pitch;\n  }\n\n  handlePitchChange(e) {\n    const pitch = this.getPitchValue(e.target.value);\n    this.audioPlayer.pitch = pitch;\n    this.setState({\n      pitch\n    });\n  }\n\n  decreasePitch(e) {\n    if (this.state.pitch > 0.5 && this.state.pitch <= 2) {\n      const key = this.state.key - 1;\n      const pitch = this.getPitchValue(key);\n      this.audioPlayer.pitch = pitch;\n      this.setState({\n        key\n      });\n      this.setState({\n        pitch\n      });\n    }\n  }\n\n  increasePitch(e) {\n    if (this.state.pitch >= 0.5 && this.state.pitch < 2) {\n      const key = this.state.key + 1;\n      const pitch = this.getPitchValue(key);\n      this.audioPlayer.pitch = pitch;\n      this.setState({\n        key\n      });\n      this.setState({\n        pitch\n      });\n    }\n  }\n\n  handleTempoChange(e) {\n    const tempo = e.target.value;\n    this.audioPlayer.tempo = tempo;\n    this.setState({\n      tempo\n    });\n  }\n\n  decreaseTempo(e) {\n    if (this.state.tempo > 0.5 && this.state.tempo <= 2) {\n      const tempo = +(Math.round(this.state.tempo - 0.1 + \"e+2\") + \"e-2\");\n      this.audioPlayer.tempo = tempo;\n      this.setState({\n        tempo\n      });\n    }\n  }\n\n  increaseTempo(e) {\n    if (this.state.tempo >= 0.5 && this.state.tempo < 2) {\n      const tempo = +(Math.round(this.state.tempo + 0.1 + \"e+2\") + \"e-2\");\n      this.audioPlayer.tempo = tempo;\n      this.setState({\n        tempo\n      });\n    }\n  }\n\n  handleSeek(e) {\n    const percent = parseFloat(e.target.value);\n    this.audioPlayer.seekPercent(percent);\n    this.play();\n  }\n\n  percentDone() {\n    if (!this.state.duration) {\n      return 0;\n    }\n\n    return this.state.t / this.state.duration * 100;\n  }\n\n  getTime() {\n    var result = \"\";\n\n    if (this.state.duration != null) {\n      var cur_tempo = this.state.tempo;\n      var whole = this.state.duration / cur_tempo;\n      var whole_min = Math.floor(whole / 60);\n      var whole_sec = Math.floor(whole - whole_min * 60);\n      var current = this.state.t / cur_tempo;\n      var cur_min = Math.floor(current / 60);\n      var cur_sec = Math.floor(current - cur_min * 60);\n      result += (cur_min < 10 ? \"0\" + cur_min : cur_min) + \":\" + (cur_sec < 10 ? \"0\" + cur_sec : cur_sec);\n      result += \"/\";\n      result += (whole_min < 10 ? \"0\" + whole_min : whole_min) + \":\" + (whole_sec < 10 ? \"0\" + whole_sec : whole_sec);\n    }\n\n    return result;\n  }\n\n  componentDidMount() {\n    this.callApi().then(res => {\n      for (var i = 0; i < res.music.length; i++) {\n        this.setState({\n          response: this.state.response.concat(res.music[i].filename)\n        });\n      }\n    }).catch(err => console.log(err));\n  }\n\n  /*handleSubmit = async e => {\n      e.preventDefault();\n      var filename = this.state.post;\n      const response = await fetch('/api/mp3?='+filename, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ post: this.state.post }),\n      });\n      const body = await response.text();\n       this.setState({ responseToPost: body });\n  };\n  */\n  printResponse() {\n    var result = \"\";\n\n    for (var i = 0; i < this.state.response.length; i++) {\n      result += this.state.response[i] + \"\\n\";\n    }\n\n    return result;\n  }\n\n  render() {\n    const items = [];\n\n    for (const [index, value] of this.state.response.entries()) {\n      items.push( /*#__PURE__*/_jsxDEV(\"li\", {\n        onClick: e => this.getMusic(e),\n        children: value\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 24\n      }, this));\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Karaoke\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row title_header alert alert-info\",\n        children: \"Karaoke\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 8\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        style: {\n          marginBottom: '1em'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"btn btn-primary btn-lg\",\n          htmlFor: \"sas-file\",\n          style: {\n            marginRight: '0.25em'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            id: \"sas-file\",\n            accept: \"audio\",\n            type: \"file\",\n            style: {\n              display: 'none'\n            },\n            onChange: e => this.handleFileChange(e)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 337,\n            columnNumber: 25\n          }, this), \"Select MP3\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(FilenameLabel, {\n          error: this.state.error,\n          filename: this.state.filename\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 346,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 331,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ErrorAlert, {\n        error: this.state.error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 349,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"\",\n          style: {\n            paddingTop: '6px'\n          },\n          children: /*#__PURE__*/_jsxDEV(TrackControls, {\n            action: this.state.action,\n            error: this.state.error,\n            filename: this.state.filename,\n            onPlay: () => this.play(),\n            onPause: () => this.pause(),\n            onStop: () => this.stop()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 353,\n            columnNumber: 22\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 352,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            children: this.getTime()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 363,\n            columnNumber: 22\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 362,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ranger\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"form-control\",\n            type: \"range\",\n            min: \"0\",\n            max: \"100\",\n            step: \"0.05\",\n            value: this.percentDone(),\n            onChange: e => this.handleSeek(e)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 366,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"output\", {\n            className: \"bubble\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 375,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 365,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btns\",\n            type: \"button\",\n            onClick: e => this.decreasePitch(e),\n            children: \" down \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 381,\n            columnNumber: 22\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"tagg\",\n            children: [\" Pitch (\", this.state.key < 0 ? this.state.key : \"+\" + this.state.key, \" key) \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 382,\n            columnNumber: 26\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btns\",\n            type: \"button\",\n            onClick: e => this.increasePitch(e),\n            children: \" up \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 383,\n            columnNumber: 22\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 380,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 379,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btns\",\n            type: \"button\",\n            onClick: e => this.decreaseTempo(e),\n            children: \" slow \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 389,\n            columnNumber: 22\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"tagg\",\n            children: [\" Tempo (\", parseFloat(this.state.tempo).toFixed(1), \"x) \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 390,\n            columnNumber: 26\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btns\",\n            type: \"button\",\n            onClick: e => this.increaseTempo(e),\n            children: \" fast \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 391,\n            columnNumber: 22\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 388,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: \"20\",\n            cols: \"30\",\n            placeholder: \"write the lyrics here...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 19\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 396,\n          columnNumber: 18\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            children: \" get mp3 \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 402,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 401,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: this.printResponse()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 405,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n            onSubmit: this.handleSubmit,\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Post to Server:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 407,\n                columnNumber: 32\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 407,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              value: this.state.post,\n              onChange: e => this.setState({\n                post: e.target.value\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 408,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              children: \"Submit\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 413,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 406,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: items\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 415,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 404,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 400,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 6\n    }, this);\n  }\n\n}\n\nexport default Karaoke;","map":{"version":3,"sources":["/Users/jonkim/Desktop/TestApp/Karaoke/client/src/components/Karaoke.jsx"],"names":["FilenameLabel","TrackControls","ErrorAlert","EventEmitter","require","React","AudioPlayer","Karaoke","Component","constructor","props","callApi","response","fetch","body","json","status","Error","message","getMusic","e","preventDefault","filename","target","outerText","method","headers","JSON","stringify","post","state","text","console","log","setState","responseToPost","action","duration","undefined","error","pitch","key","simpleFilter","t","tempo","emitter","on","concat","stop","audioPlayer","inputRef","createRef","file_location","play","pause","seekPercent","handleFileChange","files","length","emit","value","replace","file","URL","createObjectURL","reader","FileReader","readAsArrayBuffer","onload","event","buffer","decodeAudioData","result","err","type","setBuffer","getPitchValue","val","num","s_var","parseInt","handlePitchChange","decreasePitch","increasePitch","handleTempoChange","decreaseTempo","Math","round","increaseTempo","handleSeek","percent","parseFloat","percentDone","getTime","cur_tempo","whole","whole_min","floor","whole_sec","current","cur_min","cur_sec","componentDidMount","then","res","i","music","catch","printResponse","render","items","index","entries","push","marginBottom","marginRight","display","paddingTop","toFixed","handleSubmit"],"mappings":"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","sourcesContent":["import FilenameLabel from'./FilenameLabel.jsx';\nimport TrackControls from'./TrackControls.jsx';\nimport ErrorAlert from'./ErrorAlert.jsx';\n\nconst EventEmitter = require('events').EventEmitter;\nconst React = require('react');\nconst AudioPlayer = require('./../lib/AudioPlayer');\n\nclass Karaoke extends React.Component {\n\n\tconstructor(props) {\n        super(props);\n\n        this.state = {\n            action: 'stop',\n            duration: undefined,\n            error: undefined,\n            filename: undefined,\n            pitch: 1.0,\n            key: 0,\n            simpleFilter: undefined,\n            status: [],\n            t: 0,\n            tempo: 1.0,\n\n            response: [],\n            post: '',\n            responseToPost: '',\n        };\n\n        this.emitter = new EventEmitter();\n        this.emitter.on('state', state => this.setState(state));\n        this.emitter.on('status', status => {\n            if (status === 'Done!') {\n                this.setState({status: []});\n            } else {\n                this.setState({status: this.state.status.concat(status)});\n            }\n        });\n        this.emitter.on('stop', () => this.stop());\n\n        this.audioPlayer = new AudioPlayer({\n            emitter: this.emitter,\n            pitch: this.state.pitch,\n            tempo: this.state.tempo,\n        });\n\n        this.inputRef = React.createRef();\n        this.file_location = \"\";\n    }\n\n    play() {\n        if (this.state.action !== 'play') {\n            this.audioPlayer.play();\n            this.setState({action: 'play'});\n        }\n    }\n\n    pause() {\n        if (this.state.action === 'play') {\n            this.audioPlayer.pause();\n            this.setState({action: 'pause'});\n        }\n    }\n\n    stop() {\n        this.pause();\n        this.audioPlayer.seekPercent(0);\n        this.setState({action: 'stop', t: 0});\n    }\n\n    handleFileChange(e) {\n        if (e.target.files.length > 0) {\n            this.stop();\n\n            this.emitter.emit('status', 'Reading file...');\n            this.emitter.emit('state', {\n                error: undefined,\n                filename: undefined,\n            });\n\n\n\n\n            // http://stackoverflow.com/q/4851595/786644\n            const filename = e.target.value.replace('C:\\\\fakepath\\\\', '');\n            this.emitter.emit('state', {filename});\n\n            const file = e.target.files[0];\n            this.file_location = URL.createObjectURL(file);\n\n            const reader = new FileReader();\n            reader.readAsArrayBuffer(file);\n            reader.onload = async event => {\n                this.emitter.emit('status', 'Playing file...');\n\n                let buffer;\n                try {\n                    buffer = await this.audioPlayer.decodeAudioData(event.target.result);\n                } catch (err) {\n                    this.emitter.emit('state', {\n                        error: {\n                            message: err.message,\n                            type: 'Decoding error',\n                        },\n                    });\n                    return;\n                }\n\n                this.file_location = filename;\n\n                this.audioPlayer.setBuffer(buffer);\n                this.play();\n            };\n        }\n    }\n\n    //https://prgomez.com/why-do-re-mi/\n\n    getPitchValue(val) {\n    \tvar num = 0;\n    \tvar s_var = (val>=0)?(parseInt(val)):(12+parseInt(val));\n    \tswitch(s_var){\n    \t\tcase 0 : \n    \t\t\tnum = 1;\n    \t\t\tbreak;\n    \t\tcase 1 : \n    \t\t\tnum = 1.059;\n    \t\t\tbreak;\n    \t\tcase 2 : \n    \t\t\tnum = 1.122;\n    \t\t\tbreak;\n    \t\tcase 3 : \n    \t\t\tnum = 1.189;\n    \t\t\tbreak;\n    \t\tcase 4 : \n    \t\t\tnum = 1.26;\n    \t\t\tbreak;\n    \t\tcase 5 : \n    \t\t\tnum = 1.335;\n    \t\t\tbreak;\n    \t\tcase 6 : \n    \t\t\tnum = 1.414;\n    \t\t\tbreak;\n    \t\tcase 7 : \n    \t\t\tnum = 1.498;\n    \t\t\tbreak;\n    \t\tcase 8 : \n    \t\t\tnum = 1.587;\n    \t\t\tbreak;\n    \t\tcase 9 : \n    \t\t\tnum = 1.682;\n    \t\t\tbreak;\n    \t\tcase 10 : \n    \t\t\tnum = 1.782;\n    \t\t\tbreak;\n    \t\tcase 11 : \n    \t\t\tnum = 1.888;\n    \t\t\tbreak;\n    \t\tcase 12 : \n    \t\t\tnum = 2;\n    \t\t\tbreak;\n    \t\tdefault : \n    \t\t\tnum = 1;\n    \t\t\tbreak;\n    \t}\n        const pitch = (val>=0)?(num):(num/2);\n        return pitch;\n    }\n    handlePitchChange(e) {\n        const pitch = this.getPitchValue(e.target.value);\n        this.audioPlayer.pitch = pitch;\n        this.setState({pitch});\n    }\n    \n    decreasePitch(e){\n    \tif(this.state.pitch > 0.5 && this.state.pitch <= 2){\n    \t\tconst key = this.state.key-1;\n    \t\tconst pitch = this.getPitchValue(key);\n\n\t        this.audioPlayer.pitch = pitch;\n\t        this.setState({key});\n\t        this.setState({pitch});\n    \t}\n    }\n\n    increasePitch(e){\n    \tif(this.state.pitch >= 0.5 && this.state.pitch < 2){\n    \t\tconst key = this.state.key+1;\n    \t\tconst pitch = this.getPitchValue(key);\n\n\t        this.audioPlayer.pitch = pitch;\n\t        this.setState({key});\n\t        this.setState({pitch});\n    \t}\n    }\n\n    handleTempoChange(e) {\n        const tempo = e.target.value;\n        this.audioPlayer.tempo = tempo;\n        this.setState({tempo});\n    }\n\n    decreaseTempo(e) {\n    \tif(this.state.tempo > 0.5 && this.state.tempo <= 2){\n    \t\tconst tempo = +(Math.round(this.state.tempo-0.1 + \"e+2\")  + \"e-2\");\n\t        this.audioPlayer.tempo = tempo;\n\t        this.setState({tempo});\n    \t}\n    }\n\n    increaseTempo(e) {\n        if(this.state.tempo >= 0.5 && this.state.tempo < 2){\n    \t\tconst tempo = +(Math.round(this.state.tempo+0.1 + \"e+2\")  + \"e-2\");\n\t        this.audioPlayer.tempo = tempo;\n\t        this.setState({tempo});\n    \t}\n    }\n\n    handleSeek(e) {\n        const percent = parseFloat(e.target.value);\n        this.audioPlayer.seekPercent(percent);\n        this.play();\n    }\n\n    percentDone() {\n        if (!this.state.duration) {\n            return 0;\n        }\n\n        return this.state.t / this.state.duration * 100;\n    }\n\n    getTime(){\n        var result = \"\";\n        if(this.state.duration!=null){\n\n            var cur_tempo = this.state.tempo;\n\n            var whole = this.state.duration/cur_tempo;\n            var whole_min = Math.floor(whole/60);\n            var whole_sec = Math.floor(whole-whole_min*60);\n\n            var current = this.state.t/cur_tempo;\n            var cur_min = Math.floor(current/60);\n            var cur_sec = Math.floor(current-cur_min*60);\n\n\n\n            result += ((cur_min<10)?(\"0\"+cur_min):(cur_min))+\":\"+((cur_sec<10)?(\"0\"+cur_sec):(cur_sec));\n            result += \"/\";\n            result += ((whole_min<10)?(\"0\"+whole_min):(whole_min))+\":\"+((whole_sec<10)?(\"0\"+whole_sec):(whole_sec));\n        }\n    \treturn result;\n    }\n\n    componentDidMount() {\n        this.callApi()\n            .then(\n                res => {\n                    for(var i=0;i<res.music.length;i++){\n                        this.setState({ response : this.state.response.concat(res.music[i].filename) });\n                    }\n                }\n            )\n            .catch(err => console.log(err));\n    }\n      \n    callApi = async () => {\n        const response = await fetch('/api/files');\n        const body = await response.json();\n        if (response.status !== 200) throw Error(body.message);\n        return body;\n    };\n\n    /*handleSubmit = async e => {\n        e.preventDefault();\n        var filename = this.state.post;\n        const response = await fetch('/api/mp3?='+filename, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({ post: this.state.post }),\n        });\n        const body = await response.text();\n\n        this.setState({ responseToPost: body });\n    };\n    */\n\n    printResponse(){\n        var result = \"\";\n        for(var i=0; i< this.state.response.length; i++){\n            result += this.state.response[i]+\"\\n\";\n        }\n        return result;\n    }\n\n    getMusic = async e => {\n        e.preventDefault();\n        var filename = e.target.outerText;\n        const response = await fetch('/api/mp3?='+filename, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({ post: this.state.post }),\n        });\n        const body = await response.text();\n        console.log(body);\n        this.setState({ responseToPost: body });\n    } \n\n\trender (){\n\n        const items = [];\n\n        for(const [index, value] of this.state.response.entries()){\n            items.push(<li key={index} onClick={e => this.getMusic(e)}>{value}</li>);\n        }\n\n\n\t  \treturn (\n\n\t  \t\t<div className=\"Karaoke\">\n\t  \t\t  <div className=\"row title_header alert alert-info\">\n\t  \t\t  \tKaraoke\n\t  \t\t  </div>\n\n\t\t      <div className=\"row\" style={{marginBottom: '1em'}}>\n                    <label\n                        className=\"btn btn-primary btn-lg\"\n                        htmlFor=\"sas-file\"\n                        style={{marginRight: '0.25em'}}\n                    >\n                        <input\n                            id=\"sas-file\"\n                            accept=\"audio\"\n                            type=\"file\"\n                            style={{display: 'none'}}\n                            onChange={e => this.handleFileChange(e)}\n                        />\n                        Select MP3\n                    </label>\n                    <FilenameLabel error={this.state.error} filename={this.state.filename} />\n                </div>\n\n                <ErrorAlert error={this.state.error} />\n\n                <div className=\"row\">\n                    <div className=\"\" style={{paddingTop: '6px'}}>\n                    \t<TrackControls\n                            action={this.state.action}\n                            error={this.state.error}\n                            filename={this.state.filename}\n                            onPlay={() => this.play()}\n                            onPause={() => this.pause()}\n                            onStop={() => this.stop()}\n                        />\n                    </div>\n                    <div>\n                    \t<p>{this.getTime()}</p>\n                    </div>\n                    <div className=\"ranger\">\n                        <input\n                            className=\"form-control\"\n                            type=\"range\"\n                            min=\"0\"\n                            max=\"100\"\n                            step=\"0.05\"\n                            value={this.percentDone()}\n                            onChange={e => this.handleSeek(e)}\n                        />\n                        <output className=\"bubble\"></output>\n                    </div>\n                </div>\n\n                <div className=\"row\">\n                   \t<div className=\"\">\n                   \t\t<button className=\"btns\" type=\"button\" onClick={e => this.decreasePitch(e)}> down </button>\n\t                        <p className=\"tagg\"> Pitch ({ (this.state.key<0)?(this.state.key):(\"+\"+this.state.key) } key) </p>\n                    \t<button className=\"btns\" type=\"button\" onClick={e => this.increasePitch(e)}> up </button>\n                    </div>\n                </div>\n\n                <div className=\"row\">\n                    <div className=\"\">\n                    \t<button className=\"btns\" type=\"button\" onClick={e => this.decreaseTempo(e)}> slow </button>\n\t                        <p className=\"tagg\"> Tempo ({ parseFloat(this.state.tempo).toFixed(1) }x) </p>\n                    \t<button className=\"btns\" type=\"button\" onClick={e => this.increaseTempo(e)}> fast </button>\n                    </div>\n                </div>\n\n                <div className=\"row\">\n                \t<div>\n                \t\t<textarea rows=\"20\" cols=\"30\" placeholder=\"write the lyrics here...\"></textarea>\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div>\n                        <button type=\"button\" > get mp3 </button>\n                    </div>\n                    <div className=\"row\">\n                        <p>{this.printResponse()}</p>\n                        <form onSubmit={this.handleSubmit}>\n                            <p><strong>Post to Server:</strong></p>\n                            <input\n                                type=\"text\"\n                                value={this.state.post}\n                                onChange={e => this.setState({ post: e.target.value })}\n                            />\n                            <button type=\"submit\">Submit</button>\n                        </form>\n                        <p>{items}</p>\n                    </div> \n                </div>\n\n\t\t    </div>\n\n\t    )\n\t}\n\n}\n\nexport default Karaoke;\n"]},"metadata":{},"sourceType":"module"}