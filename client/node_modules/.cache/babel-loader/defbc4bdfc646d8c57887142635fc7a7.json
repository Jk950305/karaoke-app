{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/jonkim/Desktop/TestApp/Karaoke/client/src/components/Karaoke.jsx\";\nimport FilenameLabel from './FilenameLabel.jsx';\nimport TrackControls from './TrackControls.jsx';\nimport ErrorAlert from './ErrorAlert.jsx';\n\nconst EventEmitter = require('events').EventEmitter;\n\nconst React = require('react');\n\nconst AudioPlayer = require('./../lib/AudioPlayer');\n\nclass Karaoke extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.callApi = async () => {\n      const response = await fetch('/api/files');\n      const body = await response.json();\n      if (response.status !== 200) throw Error(body.message);\n      return body;\n    };\n\n    this.handleSubmit = async e => {\n      e.preventDefault();\n      var filename = this.state.post;\n      const response = await fetch('/api/world', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          post: this.state.post\n        })\n      });\n      const body = await response.text();\n      this.setState({\n        responseToPost: body\n      });\n    };\n\n    this.getMusic = async e => {\n      e.preventDefault();\n      var filename = e.target.outerText;\n      var url = '/api/mp3?file=' + filename;\n      const response = await fetch(url, {\n        method: 'GET',\n        headers: {}\n      }).then(function (response) {\n        return response.blob();\n      }).then(function (blob) {\n        console.log(this);\n        this.stop();\n        this.emitter.emit('status', 'Reading file...');\n        this.emitter.emit('state', {\n          error: undefined,\n          filename: undefined\n        }); // http://stackoverflow.com/q/4851595/786644\n\n        this.emitter.emit('state', {\n          filename\n        });\n        const file = blob;\n        const reader = new FileReader();\n        reader.readAsArrayBuffer(file);\n\n        reader.onload = async event => {\n          this.emitter.emit('status', 'Playing file...');\n          let buffer;\n\n          try {\n            buffer = await this.audioPlayer.decodeAudioData(event.target.result);\n          } catch (err) {\n            this.emitter.emit('state', {\n              error: {\n                message: err.message,\n                type: 'Decoding error'\n              }\n            });\n            return;\n          }\n\n          this.audioPlayer.setBuffer(buffer);\n          this.play();\n        };\n      }).catch(error => {//whatever\n      }); //const body = await response.json();\n      //console.log(body);\n      //this.setState({ responseToPost: body });\n    };\n\n    this.state = {\n      action: 'stop',\n      duration: undefined,\n      error: undefined,\n      filename: undefined,\n      pitch: 1.0,\n      key: 0,\n      simpleFilter: undefined,\n      status: [],\n      t: 0,\n      tempo: 1.0,\n      response: [],\n      post: '',\n      responseToPost: ''\n    };\n    this.emitter = new EventEmitter();\n    this.emitter.on('state', state => this.setState(state));\n    this.emitter.on('status', status => {\n      if (status === 'Done!') {\n        this.setState({\n          status: []\n        });\n      } else {\n        this.setState({\n          status: this.state.status.concat(status)\n        });\n      }\n    });\n    this.emitter.on('stop', () => this.stop());\n    this.audioPlayer = new AudioPlayer({\n      emitter: this.emitter,\n      pitch: this.state.pitch,\n      tempo: this.state.tempo\n    });\n    this.inputRef = React.createRef();\n  }\n\n  play() {\n    if (this.state.action !== 'play') {\n      this.audioPlayer.play();\n      this.setState({\n        action: 'play'\n      });\n    }\n  }\n\n  pause() {\n    if (this.state.action === 'play') {\n      this.audioPlayer.pause();\n      this.setState({\n        action: 'pause'\n      });\n    }\n  }\n\n  stop() {\n    this.pause();\n    this.audioPlayer.seekPercent(0);\n    this.setState({\n      action: 'stop',\n      t: 0\n    });\n  }\n\n  handleFileChange(e) {\n    console.log(e);\n\n    if (e.target.files.length > 0) {\n      this.stop();\n      this.emitter.emit('status', 'Reading file...');\n      this.emitter.emit('state', {\n        error: undefined,\n        filename: undefined\n      }); // http://stackoverflow.com/q/4851595/786644\n\n      const filename = e.target.value.replace('C:\\\\fakepath\\\\', '');\n      this.emitter.emit('state', {\n        filename\n      });\n      const file = e.target.files[0];\n      const reader = new FileReader();\n      reader.readAsArrayBuffer(file);\n\n      reader.onload = async event => {\n        this.emitter.emit('status', 'Playing file...');\n        let buffer;\n\n        try {\n          buffer = await this.audioPlayer.decodeAudioData(event.target.result);\n        } catch (err) {\n          this.emitter.emit('state', {\n            error: {\n              message: err.message,\n              type: 'Decoding error'\n            }\n          });\n          return;\n        }\n\n        this.audioPlayer.setBuffer(buffer);\n        this.play();\n      };\n    }\n  } //https://prgomez.com/why-do-re-mi/\n\n\n  getPitchValue(val) {\n    var num = 0;\n    var s_var = val >= 0 ? parseInt(val) : 12 + parseInt(val);\n\n    switch (s_var) {\n      case 0:\n        num = 1;\n        break;\n\n      case 1:\n        num = 1.059;\n        break;\n\n      case 2:\n        num = 1.122;\n        break;\n\n      case 3:\n        num = 1.189;\n        break;\n\n      case 4:\n        num = 1.26;\n        break;\n\n      case 5:\n        num = 1.335;\n        break;\n\n      case 6:\n        num = 1.414;\n        break;\n\n      case 7:\n        num = 1.498;\n        break;\n\n      case 8:\n        num = 1.587;\n        break;\n\n      case 9:\n        num = 1.682;\n        break;\n\n      case 10:\n        num = 1.782;\n        break;\n\n      case 11:\n        num = 1.888;\n        break;\n\n      case 12:\n        num = 2;\n        break;\n\n      default:\n        num = 1;\n        break;\n    }\n\n    const pitch = val >= 0 ? num : num / 2;\n    return pitch;\n  }\n\n  handlePitchChange(e) {\n    const pitch = this.getPitchValue(e.target.value);\n    this.audioPlayer.pitch = pitch;\n    this.setState({\n      pitch\n    });\n  }\n\n  decreasePitch(e) {\n    if (this.state.pitch > 0.5 && this.state.pitch <= 2) {\n      const key = this.state.key - 1;\n      const pitch = this.getPitchValue(key);\n      this.audioPlayer.pitch = pitch;\n      this.setState({\n        key\n      });\n      this.setState({\n        pitch\n      });\n    }\n  }\n\n  increasePitch(e) {\n    if (this.state.pitch >= 0.5 && this.state.pitch < 2) {\n      const key = this.state.key + 1;\n      const pitch = this.getPitchValue(key);\n      this.audioPlayer.pitch = pitch;\n      this.setState({\n        key\n      });\n      this.setState({\n        pitch\n      });\n    }\n  }\n\n  handleTempoChange(e) {\n    const tempo = e.target.value;\n    this.audioPlayer.tempo = tempo;\n    this.setState({\n      tempo\n    });\n  }\n\n  decreaseTempo(e) {\n    if (this.state.tempo > 0.5 && this.state.tempo <= 2) {\n      const tempo = +(Math.round(this.state.tempo - 0.1 + \"e+2\") + \"e-2\");\n      this.audioPlayer.tempo = tempo;\n      this.setState({\n        tempo\n      });\n    }\n  }\n\n  increaseTempo(e) {\n    if (this.state.tempo >= 0.5 && this.state.tempo < 2) {\n      const tempo = +(Math.round(this.state.tempo + 0.1 + \"e+2\") + \"e-2\");\n      this.audioPlayer.tempo = tempo;\n      this.setState({\n        tempo\n      });\n    }\n  }\n\n  handleSeek(e) {\n    const percent = parseFloat(e.target.value);\n    this.audioPlayer.seekPercent(percent);\n    this.play();\n  }\n\n  percentDone() {\n    if (!this.state.duration) {\n      return 0;\n    }\n\n    return this.state.t / this.state.duration * 100;\n  }\n\n  getTime() {\n    var result = \"\";\n\n    if (this.state.duration != null) {\n      var cur_tempo = this.state.tempo;\n      var whole = this.state.duration / cur_tempo;\n      var whole_min = Math.floor(whole / 60);\n      var whole_sec = Math.floor(whole - whole_min * 60);\n      var current = this.state.t / cur_tempo;\n      var cur_min = Math.floor(current / 60);\n      var cur_sec = Math.floor(current - cur_min * 60);\n      result += (cur_min < 10 ? \"0\" + cur_min : cur_min) + \":\" + (cur_sec < 10 ? \"0\" + cur_sec : cur_sec);\n      result += \"/\";\n      result += (whole_min < 10 ? \"0\" + whole_min : whole_min) + \":\" + (whole_sec < 10 ? \"0\" + whole_sec : whole_sec);\n    }\n\n    return result;\n  }\n\n  componentDidMount() {\n    this.callApi().then(res => {\n      for (var i = 0; i < res.music.length; i++) {\n        this.setState({\n          response: this.state.response.concat(res.music[i].filename)\n        });\n      }\n    }).catch(err => console.log(err));\n  }\n\n  printResponse() {\n    var result = \"\";\n\n    for (var i = 0; i < this.state.response.length; i++) {\n      result += this.state.response[i] + \"\\n\";\n    }\n\n    return result;\n  }\n\n  render() {\n    const items = [];\n\n    for (const [index, value] of this.state.response.entries()) {\n      items.push( /*#__PURE__*/_jsxDEV(\"li\", {\n        onClick: e => this.getMusic(e),\n        children: value\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 358,\n        columnNumber: 24\n      }, this));\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Karaoke\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row title_header alert alert-info\",\n        children: \"Karaoke\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 365,\n        columnNumber: 8\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        style: {\n          marginBottom: '1em'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          className: \"btn btn-primary btn-lg\",\n          htmlFor: \"sas-file\",\n          style: {\n            marginRight: '0.25em'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            id: \"sas-file\",\n            accept: \"audio\",\n            type: \"file\",\n            style: {\n              display: 'none'\n            },\n            onChange: e => this.handleFileChange(e)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 375,\n            columnNumber: 25\n          }, this), \"Select MP3\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 370,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(FilenameLabel, {\n          error: this.state.error,\n          filename: this.state.filename\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 384,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 369,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ErrorAlert, {\n        error: this.state.error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"\",\n          style: {\n            paddingTop: '6px'\n          },\n          children: /*#__PURE__*/_jsxDEV(TrackControls, {\n            action: this.state.action,\n            error: this.state.error,\n            filename: this.state.filename,\n            onPlay: () => this.play(),\n            onPause: () => this.pause(),\n            onStop: () => this.stop()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 391,\n            columnNumber: 22\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 390,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"p\", {\n            children: this.getTime()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 401,\n            columnNumber: 22\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 400,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ranger\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"form-control\",\n            type: \"range\",\n            min: \"0\",\n            max: \"100\",\n            step: \"0.05\",\n            value: this.percentDone(),\n            onChange: e => this.handleSeek(e)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 404,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"output\", {\n            className: \"bubble\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 413,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 403,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 389,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btns\",\n            type: \"button\",\n            onClick: e => this.decreasePitch(e),\n            children: \" down \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 419,\n            columnNumber: 22\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"tagg\",\n            children: [\" Pitch (\", this.state.key < 0 ? this.state.key : \"+\" + this.state.key, \" key) \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 420,\n            columnNumber: 26\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btns\",\n            type: \"button\",\n            onClick: e => this.increasePitch(e),\n            children: \" up \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 421,\n            columnNumber: 22\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 418,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 417,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btns\",\n            type: \"button\",\n            onClick: e => this.decreaseTempo(e),\n            children: \" slow \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 427,\n            columnNumber: 22\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"tagg\",\n            children: [\" Tempo (\", parseFloat(this.state.tempo).toFixed(1), \"x) \"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 428,\n            columnNumber: 26\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btns\",\n            type: \"button\",\n            onClick: e => this.increaseTempo(e),\n            children: \" fast \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 429,\n            columnNumber: 22\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 426,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 425,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n            rows: \"20\",\n            cols: \"30\",\n            placeholder: \"write the lyrics here...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 435,\n            columnNumber: 19\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 434,\n          columnNumber: 18\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 433,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            children: \" get mp3 \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 440,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 439,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: this.printResponse()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 443,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n            onSubmit: this.handleSubmit,\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Post to Server:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 445,\n                columnNumber: 32\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 445,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              value: this.state.post,\n              onChange: e => this.setState({\n                post: e.target.value\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 446,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              children: \"Submit\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 451,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 444,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: items\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 453,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 442,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 6\n    }, this);\n  }\n\n}\n\nexport default Karaoke;","map":{"version":3,"sources":["/Users/jonkim/Desktop/TestApp/Karaoke/client/src/components/Karaoke.jsx"],"names":["FilenameLabel","TrackControls","ErrorAlert","EventEmitter","require","React","AudioPlayer","Karaoke","Component","constructor","props","callApi","response","fetch","body","json","status","Error","message","handleSubmit","e","preventDefault","filename","state","post","method","headers","JSON","stringify","text","setState","responseToPost","getMusic","target","outerText","url","then","blob","console","log","stop","emitter","emit","error","undefined","file","reader","FileReader","readAsArrayBuffer","onload","event","buffer","audioPlayer","decodeAudioData","result","err","type","setBuffer","play","catch","action","duration","pitch","key","simpleFilter","t","tempo","on","concat","inputRef","createRef","pause","seekPercent","handleFileChange","files","length","value","replace","getPitchValue","val","num","s_var","parseInt","handlePitchChange","decreasePitch","increasePitch","handleTempoChange","decreaseTempo","Math","round","increaseTempo","handleSeek","percent","parseFloat","percentDone","getTime","cur_tempo","whole","whole_min","floor","whole_sec","current","cur_min","cur_sec","componentDidMount","res","i","music","printResponse","render","items","index","entries","push","marginBottom","marginRight","display","paddingTop","toFixed"],"mappings":";;AAAA,OAAOA,aAAP,MAAyB,qBAAzB;AACA,OAAOC,aAAP,MAAyB,qBAAzB;AACA,OAAOC,UAAP,MAAsB,kBAAtB;;AAEA,MAAMC,YAAY,GAAGC,OAAO,CAAC,QAAD,CAAP,CAAkBD,YAAvC;;AACA,MAAME,KAAK,GAAGD,OAAO,CAAC,OAAD,CAArB;;AACA,MAAME,WAAW,GAAGF,OAAO,CAAC,sBAAD,CAA3B;;AAEA,MAAMG,OAAN,SAAsBF,KAAK,CAACG,SAA5B,CAAsC;AAErCC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACZ,UAAMA,KAAN;;AADY,SA6PhBC,OA7PgB,GA6PN,YAAY;AAClB,YAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,YAAD,CAA5B;AACA,YAAMC,IAAI,GAAG,MAAMF,QAAQ,CAACG,IAAT,EAAnB;AACA,UAAIH,QAAQ,CAACI,MAAT,KAAoB,GAAxB,EAA6B,MAAMC,KAAK,CAACH,IAAI,CAACI,OAAN,CAAX;AAC7B,aAAOJ,IAAP;AACH,KAlQe;;AAAA,SAoQhBK,YApQgB,GAoQD,MAAMC,CAAN,IAAW;AACtBA,MAAAA,CAAC,CAACC,cAAF;AACA,UAAIC,QAAQ,GAAG,KAAKC,KAAL,CAAWC,IAA1B;AACA,YAAMZ,QAAQ,GAAG,MAAMC,KAAK,CAAC,YAAD,EAAe;AACzCY,QAAAA,MAAM,EAAE,MADiC;AAEzCC,QAAAA,OAAO,EAAE;AACP,0BAAgB;AADT,SAFgC;AAKzCZ,QAAAA,IAAI,EAAEa,IAAI,CAACC,SAAL,CAAe;AAAEJ,UAAAA,IAAI,EAAE,KAAKD,KAAL,CAAWC;AAAnB,SAAf;AALmC,OAAf,CAA5B;AAOA,YAAMV,IAAI,GAAG,MAAMF,QAAQ,CAACiB,IAAT,EAAnB;AAEA,WAAKC,QAAL,CAAc;AAAEC,QAAAA,cAAc,EAAEjB;AAAlB,OAAd;AACH,KAjRe;;AAAA,SA2RhBkB,QA3RgB,GA2RL,MAAMZ,CAAN,IAAW;AAClBA,MAAAA,CAAC,CAACC,cAAF;AACA,UAAIC,QAAQ,GAAGF,CAAC,CAACa,MAAF,CAASC,SAAxB;AACA,UAAIC,GAAG,GAAG,mBAAiBb,QAA3B;AACA,YAAMV,QAAQ,GAAG,MAAMC,KAAK,CAAEsB,GAAF,EAAO;AAC/BV,QAAAA,MAAM,EAAE,KADuB;AAE/BC,QAAAA,OAAO,EAAE;AAFsB,OAAP,CAAL,CAGpBU,IAHoB,CAGf,UAAUxB,QAAV,EAAoB;AAChB,eAAOA,QAAQ,CAACyB,IAAT,EAAP;AACH,OALc,EAOlBD,IAPkB,CAOb,UAASC,IAAT,EAAe;AACjBC,QAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACA,aAAKC,IAAL;AAEA,aAAKC,OAAL,CAAaC,IAAb,CAAkB,QAAlB,EAA4B,iBAA5B;AACA,aAAKD,OAAL,CAAaC,IAAb,CAAkB,OAAlB,EAA2B;AACvBC,UAAAA,KAAK,EAAEC,SADgB;AAEvBtB,UAAAA,QAAQ,EAAEsB;AAFa,SAA3B,EALiB,CAUjB;;AACA,aAAKH,OAAL,CAAaC,IAAb,CAAkB,OAAlB,EAA2B;AAACpB,UAAAA;AAAD,SAA3B;AAEA,cAAMuB,IAAI,GAAGR,IAAb;AAEA,cAAMS,MAAM,GAAG,IAAIC,UAAJ,EAAf;AACAD,QAAAA,MAAM,CAACE,iBAAP,CAAyBH,IAAzB;;AACAC,QAAAA,MAAM,CAACG,MAAP,GAAgB,MAAMC,KAAN,IAAe;AAC3B,eAAKT,OAAL,CAAaC,IAAb,CAAkB,QAAlB,EAA4B,iBAA5B;AAEA,cAAIS,MAAJ;;AACA,cAAI;AACAA,YAAAA,MAAM,GAAG,MAAM,KAAKC,WAAL,CAAiBC,eAAjB,CAAiCH,KAAK,CAACjB,MAAN,CAAaqB,MAA9C,CAAf;AACH,WAFD,CAEE,OAAOC,GAAP,EAAY;AACV,iBAAKd,OAAL,CAAaC,IAAb,CAAkB,OAAlB,EAA2B;AACvBC,cAAAA,KAAK,EAAE;AACHzB,gBAAAA,OAAO,EAAEqC,GAAG,CAACrC,OADV;AAEHsC,gBAAAA,IAAI,EAAE;AAFH;AADgB,aAA3B;AAMA;AACH;;AAGD,eAAKJ,WAAL,CAAiBK,SAAjB,CAA2BN,MAA3B;AACA,eAAKO,IAAL;AACH,SAnBD;AAoBH,OA5CkB,EA6ClBC,KA7CkB,CA6CZhB,KAAK,IAAI,CACZ;AACH,OA/CkB,CAAvB,CAJkB,CAoDlB;AACA;AACA;AACH,KAlVe;;AAGZ,SAAKpB,KAAL,GAAa;AACTqC,MAAAA,MAAM,EAAE,MADC;AAETC,MAAAA,QAAQ,EAAEjB,SAFD;AAGTD,MAAAA,KAAK,EAAEC,SAHE;AAITtB,MAAAA,QAAQ,EAAEsB,SAJD;AAKTkB,MAAAA,KAAK,EAAE,GALE;AAMTC,MAAAA,GAAG,EAAE,CANI;AAOTC,MAAAA,YAAY,EAAEpB,SAPL;AAQT5B,MAAAA,MAAM,EAAE,EARC;AASTiD,MAAAA,CAAC,EAAE,CATM;AAUTC,MAAAA,KAAK,EAAE,GAVE;AAYTtD,MAAAA,QAAQ,EAAE,EAZD;AAaTY,MAAAA,IAAI,EAAE,EAbG;AAcTO,MAAAA,cAAc,EAAE;AAdP,KAAb;AAiBA,SAAKU,OAAL,GAAe,IAAItC,YAAJ,EAAf;AACA,SAAKsC,OAAL,CAAa0B,EAAb,CAAgB,OAAhB,EAAyB5C,KAAK,IAAI,KAAKO,QAAL,CAAcP,KAAd,CAAlC;AACA,SAAKkB,OAAL,CAAa0B,EAAb,CAAgB,QAAhB,EAA0BnD,MAAM,IAAI;AAChC,UAAIA,MAAM,KAAK,OAAf,EAAwB;AACpB,aAAKc,QAAL,CAAc;AAACd,UAAAA,MAAM,EAAE;AAAT,SAAd;AACH,OAFD,MAEO;AACH,aAAKc,QAAL,CAAc;AAACd,UAAAA,MAAM,EAAE,KAAKO,KAAL,CAAWP,MAAX,CAAkBoD,MAAlB,CAAyBpD,MAAzB;AAAT,SAAd;AACH;AACJ,KAND;AAOA,SAAKyB,OAAL,CAAa0B,EAAb,CAAgB,MAAhB,EAAwB,MAAM,KAAK3B,IAAL,EAA9B;AAEA,SAAKY,WAAL,GAAmB,IAAI9C,WAAJ,CAAgB;AAC/BmC,MAAAA,OAAO,EAAE,KAAKA,OADiB;AAE/BqB,MAAAA,KAAK,EAAE,KAAKvC,KAAL,CAAWuC,KAFa;AAG/BI,MAAAA,KAAK,EAAE,KAAK3C,KAAL,CAAW2C;AAHa,KAAhB,CAAnB;AAMA,SAAKG,QAAL,GAAgBhE,KAAK,CAACiE,SAAN,EAAhB;AACH;;AAEDZ,EAAAA,IAAI,GAAG;AACH,QAAI,KAAKnC,KAAL,CAAWqC,MAAX,KAAsB,MAA1B,EAAkC;AAC9B,WAAKR,WAAL,CAAiBM,IAAjB;AACA,WAAK5B,QAAL,CAAc;AAAC8B,QAAAA,MAAM,EAAE;AAAT,OAAd;AACH;AACJ;;AAEDW,EAAAA,KAAK,GAAG;AACJ,QAAI,KAAKhD,KAAL,CAAWqC,MAAX,KAAsB,MAA1B,EAAkC;AAC9B,WAAKR,WAAL,CAAiBmB,KAAjB;AACA,WAAKzC,QAAL,CAAc;AAAC8B,QAAAA,MAAM,EAAE;AAAT,OAAd;AACH;AACJ;;AAEDpB,EAAAA,IAAI,GAAG;AACH,SAAK+B,KAAL;AACA,SAAKnB,WAAL,CAAiBoB,WAAjB,CAA6B,CAA7B;AACA,SAAK1C,QAAL,CAAc;AAAC8B,MAAAA,MAAM,EAAE,MAAT;AAAiBK,MAAAA,CAAC,EAAE;AAApB,KAAd;AACH;;AAEDQ,EAAAA,gBAAgB,CAACrD,CAAD,EAAI;AAChBkB,IAAAA,OAAO,CAACC,GAAR,CAAYnB,CAAZ;;AACA,QAAIA,CAAC,CAACa,MAAF,CAASyC,KAAT,CAAeC,MAAf,GAAwB,CAA5B,EAA+B;AAC3B,WAAKnC,IAAL;AAEA,WAAKC,OAAL,CAAaC,IAAb,CAAkB,QAAlB,EAA4B,iBAA5B;AACA,WAAKD,OAAL,CAAaC,IAAb,CAAkB,OAAlB,EAA2B;AACvBC,QAAAA,KAAK,EAAEC,SADgB;AAEvBtB,QAAAA,QAAQ,EAAEsB;AAFa,OAA3B,EAJ2B,CAS3B;;AACA,YAAMtB,QAAQ,GAAGF,CAAC,CAACa,MAAF,CAAS2C,KAAT,CAAeC,OAAf,CAAuB,gBAAvB,EAAyC,EAAzC,CAAjB;AACA,WAAKpC,OAAL,CAAaC,IAAb,CAAkB,OAAlB,EAA2B;AAACpB,QAAAA;AAAD,OAA3B;AAEA,YAAMuB,IAAI,GAAGzB,CAAC,CAACa,MAAF,CAASyC,KAAT,CAAe,CAAf,CAAb;AAEA,YAAM5B,MAAM,GAAG,IAAIC,UAAJ,EAAf;AACAD,MAAAA,MAAM,CAACE,iBAAP,CAAyBH,IAAzB;;AACAC,MAAAA,MAAM,CAACG,MAAP,GAAgB,MAAMC,KAAN,IAAe;AAC3B,aAAKT,OAAL,CAAaC,IAAb,CAAkB,QAAlB,EAA4B,iBAA5B;AAEA,YAAIS,MAAJ;;AACA,YAAI;AACAA,UAAAA,MAAM,GAAG,MAAM,KAAKC,WAAL,CAAiBC,eAAjB,CAAiCH,KAAK,CAACjB,MAAN,CAAaqB,MAA9C,CAAf;AACH,SAFD,CAEE,OAAOC,GAAP,EAAY;AACV,eAAKd,OAAL,CAAaC,IAAb,CAAkB,OAAlB,EAA2B;AACvBC,YAAAA,KAAK,EAAE;AACHzB,cAAAA,OAAO,EAAEqC,GAAG,CAACrC,OADV;AAEHsC,cAAAA,IAAI,EAAE;AAFH;AADgB,WAA3B;AAMA;AACH;;AAGD,aAAKJ,WAAL,CAAiBK,SAAjB,CAA2BN,MAA3B;AACA,aAAKO,IAAL;AACH,OAnBD;AAoBH;AACJ,GAtGiC,CAwGlC;;;AAEAoB,EAAAA,aAAa,CAACC,GAAD,EAAM;AAClB,QAAIC,GAAG,GAAG,CAAV;AACA,QAAIC,KAAK,GAAIF,GAAG,IAAE,CAAN,GAAUG,QAAQ,CAACH,GAAD,CAAlB,GAA0B,KAAGG,QAAQ,CAACH,GAAD,CAAjD;;AACA,YAAOE,KAAP;AACC,WAAK,CAAL;AACCD,QAAAA,GAAG,GAAG,CAAN;AACA;;AACD,WAAK,CAAL;AACCA,QAAAA,GAAG,GAAG,KAAN;AACA;;AACD,WAAK,CAAL;AACCA,QAAAA,GAAG,GAAG,KAAN;AACA;;AACD,WAAK,CAAL;AACCA,QAAAA,GAAG,GAAG,KAAN;AACA;;AACD,WAAK,CAAL;AACCA,QAAAA,GAAG,GAAG,IAAN;AACA;;AACD,WAAK,CAAL;AACCA,QAAAA,GAAG,GAAG,KAAN;AACA;;AACD,WAAK,CAAL;AACCA,QAAAA,GAAG,GAAG,KAAN;AACA;;AACD,WAAK,CAAL;AACCA,QAAAA,GAAG,GAAG,KAAN;AACA;;AACD,WAAK,CAAL;AACCA,QAAAA,GAAG,GAAG,KAAN;AACA;;AACD,WAAK,CAAL;AACCA,QAAAA,GAAG,GAAG,KAAN;AACA;;AACD,WAAK,EAAL;AACCA,QAAAA,GAAG,GAAG,KAAN;AACA;;AACD,WAAK,EAAL;AACCA,QAAAA,GAAG,GAAG,KAAN;AACA;;AACD,WAAK,EAAL;AACCA,QAAAA,GAAG,GAAG,CAAN;AACA;;AACD;AACCA,QAAAA,GAAG,GAAG,CAAN;AACA;AA1CF;;AA4CG,UAAMlB,KAAK,GAAIiB,GAAG,IAAE,CAAN,GAAUC,GAAV,GAAgBA,GAAG,GAAC,CAAlC;AACA,WAAOlB,KAAP;AACH;;AACDqB,EAAAA,iBAAiB,CAAC/D,CAAD,EAAI;AACjB,UAAM0C,KAAK,GAAG,KAAKgB,aAAL,CAAmB1D,CAAC,CAACa,MAAF,CAAS2C,KAA5B,CAAd;AACA,SAAKxB,WAAL,CAAiBU,KAAjB,GAAyBA,KAAzB;AACA,SAAKhC,QAAL,CAAc;AAACgC,MAAAA;AAAD,KAAd;AACH;;AAEDsB,EAAAA,aAAa,CAAChE,CAAD,EAAG;AACf,QAAG,KAAKG,KAAL,CAAWuC,KAAX,GAAmB,GAAnB,IAA0B,KAAKvC,KAAL,CAAWuC,KAAX,IAAoB,CAAjD,EAAmD;AAClD,YAAMC,GAAG,GAAG,KAAKxC,KAAL,CAAWwC,GAAX,GAAe,CAA3B;AACA,YAAMD,KAAK,GAAG,KAAKgB,aAAL,CAAmBf,GAAnB,CAAd;AAEG,WAAKX,WAAL,CAAiBU,KAAjB,GAAyBA,KAAzB;AACA,WAAKhC,QAAL,CAAc;AAACiC,QAAAA;AAAD,OAAd;AACA,WAAKjC,QAAL,CAAc;AAACgC,QAAAA;AAAD,OAAd;AACH;AACD;;AAEDuB,EAAAA,aAAa,CAACjE,CAAD,EAAG;AACf,QAAG,KAAKG,KAAL,CAAWuC,KAAX,IAAoB,GAApB,IAA2B,KAAKvC,KAAL,CAAWuC,KAAX,GAAmB,CAAjD,EAAmD;AAClD,YAAMC,GAAG,GAAG,KAAKxC,KAAL,CAAWwC,GAAX,GAAe,CAA3B;AACA,YAAMD,KAAK,GAAG,KAAKgB,aAAL,CAAmBf,GAAnB,CAAd;AAEG,WAAKX,WAAL,CAAiBU,KAAjB,GAAyBA,KAAzB;AACA,WAAKhC,QAAL,CAAc;AAACiC,QAAAA;AAAD,OAAd;AACA,WAAKjC,QAAL,CAAc;AAACgC,QAAAA;AAAD,OAAd;AACH;AACD;;AAEDwB,EAAAA,iBAAiB,CAAClE,CAAD,EAAI;AACjB,UAAM8C,KAAK,GAAG9C,CAAC,CAACa,MAAF,CAAS2C,KAAvB;AACA,SAAKxB,WAAL,CAAiBc,KAAjB,GAAyBA,KAAzB;AACA,SAAKpC,QAAL,CAAc;AAACoC,MAAAA;AAAD,KAAd;AACH;;AAEDqB,EAAAA,aAAa,CAACnE,CAAD,EAAI;AAChB,QAAG,KAAKG,KAAL,CAAW2C,KAAX,GAAmB,GAAnB,IAA0B,KAAK3C,KAAL,CAAW2C,KAAX,IAAoB,CAAjD,EAAmD;AAClD,YAAMA,KAAK,GAAG,EAAEsB,IAAI,CAACC,KAAL,CAAW,KAAKlE,KAAL,CAAW2C,KAAX,GAAiB,GAAjB,GAAuB,KAAlC,IAA4C,KAA9C,CAAd;AACG,WAAKd,WAAL,CAAiBc,KAAjB,GAAyBA,KAAzB;AACA,WAAKpC,QAAL,CAAc;AAACoC,QAAAA;AAAD,OAAd;AACH;AACD;;AAEDwB,EAAAA,aAAa,CAACtE,CAAD,EAAI;AACb,QAAG,KAAKG,KAAL,CAAW2C,KAAX,IAAoB,GAApB,IAA2B,KAAK3C,KAAL,CAAW2C,KAAX,GAAmB,CAAjD,EAAmD;AACrD,YAAMA,KAAK,GAAG,EAAEsB,IAAI,CAACC,KAAL,CAAW,KAAKlE,KAAL,CAAW2C,KAAX,GAAiB,GAAjB,GAAuB,KAAlC,IAA4C,KAA9C,CAAd;AACG,WAAKd,WAAL,CAAiBc,KAAjB,GAAyBA,KAAzB;AACA,WAAKpC,QAAL,CAAc;AAACoC,QAAAA;AAAD,OAAd;AACH;AACD;;AAEDyB,EAAAA,UAAU,CAACvE,CAAD,EAAI;AACV,UAAMwE,OAAO,GAAGC,UAAU,CAACzE,CAAC,CAACa,MAAF,CAAS2C,KAAV,CAA1B;AACA,SAAKxB,WAAL,CAAiBoB,WAAjB,CAA6BoB,OAA7B;AACA,SAAKlC,IAAL;AACH;;AAEDoC,EAAAA,WAAW,GAAG;AACV,QAAI,CAAC,KAAKvE,KAAL,CAAWsC,QAAhB,EAA0B;AACtB,aAAO,CAAP;AACH;;AAED,WAAO,KAAKtC,KAAL,CAAW0C,CAAX,GAAe,KAAK1C,KAAL,CAAWsC,QAA1B,GAAqC,GAA5C;AACH;;AAEDkC,EAAAA,OAAO,GAAE;AACL,QAAIzC,MAAM,GAAG,EAAb;;AACA,QAAG,KAAK/B,KAAL,CAAWsC,QAAX,IAAqB,IAAxB,EAA6B;AAEzB,UAAImC,SAAS,GAAG,KAAKzE,KAAL,CAAW2C,KAA3B;AAEA,UAAI+B,KAAK,GAAG,KAAK1E,KAAL,CAAWsC,QAAX,GAAoBmC,SAAhC;AACA,UAAIE,SAAS,GAAGV,IAAI,CAACW,KAAL,CAAWF,KAAK,GAAC,EAAjB,CAAhB;AACA,UAAIG,SAAS,GAAGZ,IAAI,CAACW,KAAL,CAAWF,KAAK,GAACC,SAAS,GAAC,EAA3B,CAAhB;AAEA,UAAIG,OAAO,GAAG,KAAK9E,KAAL,CAAW0C,CAAX,GAAa+B,SAA3B;AACA,UAAIM,OAAO,GAAGd,IAAI,CAACW,KAAL,CAAWE,OAAO,GAAC,EAAnB,CAAd;AACA,UAAIE,OAAO,GAAGf,IAAI,CAACW,KAAL,CAAWE,OAAO,GAACC,OAAO,GAAC,EAA3B,CAAd;AAIAhD,MAAAA,MAAM,IAAI,CAAEgD,OAAO,GAAC,EAAT,GAAc,MAAIA,OAAlB,GAA4BA,OAA7B,IAAuC,GAAvC,IAA6CC,OAAO,GAAC,EAAT,GAAc,MAAIA,OAAlB,GAA4BA,OAAxE,CAAV;AACAjD,MAAAA,MAAM,IAAI,GAAV;AACAA,MAAAA,MAAM,IAAI,CAAE4C,SAAS,GAAC,EAAX,GAAgB,MAAIA,SAApB,GAAgCA,SAAjC,IAA6C,GAA7C,IAAmDE,SAAS,GAAC,EAAX,GAAgB,MAAIA,SAApB,GAAgCA,SAAlF,CAAV;AACH;;AACJ,WAAO9C,MAAP;AACA;;AAEDkD,EAAAA,iBAAiB,GAAG;AAChB,SAAK7F,OAAL,GACKyB,IADL,CAEQqE,GAAG,IAAI;AACH,WAAI,IAAIC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACD,GAAG,CAACE,KAAJ,CAAUhC,MAAxB,EAA+B+B,CAAC,EAAhC,EAAmC;AAC/B,aAAK5E,QAAL,CAAc;AAAElB,UAAAA,QAAQ,EAAG,KAAKW,KAAL,CAAWX,QAAX,CAAoBwD,MAApB,CAA2BqC,GAAG,CAACE,KAAJ,CAAUD,CAAV,EAAapF,QAAxC;AAAb,SAAd;AACH;AACJ,KANT,EAQKqC,KARL,CAQWJ,GAAG,IAAIjB,OAAO,CAACC,GAAR,CAAYgB,GAAZ,CARlB;AASH;;AAwBDqD,EAAAA,aAAa,GAAE;AACX,QAAItD,MAAM,GAAG,EAAb;;AACA,SAAI,IAAIoD,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAE,KAAKnF,KAAL,CAAWX,QAAX,CAAoB+D,MAApC,EAA4C+B,CAAC,EAA7C,EAAgD;AAC5CpD,MAAAA,MAAM,IAAI,KAAK/B,KAAL,CAAWX,QAAX,CAAoB8F,CAApB,IAAuB,IAAjC;AACH;;AACD,WAAOpD,MAAP;AACH;;AA6DJuD,EAAAA,MAAM,GAAG;AAEF,UAAMC,KAAK,GAAG,EAAd;;AAEA,SAAI,MAAM,CAACC,KAAD,EAAQnC,KAAR,CAAV,IAA4B,KAAKrD,KAAL,CAAWX,QAAX,CAAoBoG,OAApB,EAA5B,EAA0D;AACtDF,MAAAA,KAAK,CAACG,IAAN,eAAW;AAAgB,QAAA,OAAO,EAAE7F,CAAC,IAAI,KAAKY,QAAL,CAAcZ,CAAd,CAA9B;AAAA,kBAAiDwD;AAAjD,SAASmC,KAAT;AAAA;AAAA;AAAA;AAAA,cAAX;AACH;;AAGL,wBAEC;AAAK,MAAA,SAAS,EAAC,SAAf;AAAA,8BACE;AAAK,QAAA,SAAS,EAAC,mCAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cADF,eAKG;AAAK,QAAA,SAAS,EAAC,KAAf;AAAqB,QAAA,KAAK,EAAE;AAACG,UAAAA,YAAY,EAAE;AAAf,SAA5B;AAAA,gCACY;AACI,UAAA,SAAS,EAAC,wBADd;AAEI,UAAA,OAAO,EAAC,UAFZ;AAGI,UAAA,KAAK,EAAE;AAACC,YAAAA,WAAW,EAAE;AAAd,WAHX;AAAA,kCAKI;AACI,YAAA,EAAE,EAAC,UADP;AAEI,YAAA,MAAM,EAAC,OAFX;AAGI,YAAA,IAAI,EAAC,MAHT;AAII,YAAA,KAAK,EAAE;AAACC,cAAAA,OAAO,EAAE;AAAV,aAJX;AAKI,YAAA,QAAQ,EAAEhG,CAAC,IAAI,KAAKqD,gBAAL,CAAsBrD,CAAtB;AALnB;AAAA;AAAA;AAAA;AAAA,kBALJ;AAAA;AAAA;AAAA;AAAA;AAAA,gBADZ,eAeY,QAAC,aAAD;AAAe,UAAA,KAAK,EAAE,KAAKG,KAAL,CAAWoB,KAAjC;AAAwC,UAAA,QAAQ,EAAE,KAAKpB,KAAL,CAAWD;AAA7D;AAAA;AAAA;AAAA;AAAA,gBAfZ;AAAA;AAAA;AAAA;AAAA;AAAA,cALH,eAuBW,QAAC,UAAD;AAAY,QAAA,KAAK,EAAE,KAAKC,KAAL,CAAWoB;AAA9B;AAAA;AAAA;AAAA;AAAA,cAvBX,eAyBW;AAAK,QAAA,SAAS,EAAC,KAAf;AAAA,gCACI;AAAK,UAAA,SAAS,EAAC,EAAf;AAAkB,UAAA,KAAK,EAAE;AAAC0E,YAAAA,UAAU,EAAE;AAAb,WAAzB;AAAA,iCACC,QAAC,aAAD;AACO,YAAA,MAAM,EAAE,KAAK9F,KAAL,CAAWqC,MAD1B;AAEO,YAAA,KAAK,EAAE,KAAKrC,KAAL,CAAWoB,KAFzB;AAGO,YAAA,QAAQ,EAAE,KAAKpB,KAAL,CAAWD,QAH5B;AAIO,YAAA,MAAM,EAAE,MAAM,KAAKoC,IAAL,EAJrB;AAKO,YAAA,OAAO,EAAE,MAAM,KAAKa,KAAL,EALtB;AAMO,YAAA,MAAM,EAAE,MAAM,KAAK/B,IAAL;AANrB;AAAA;AAAA;AAAA;AAAA;AADD;AAAA;AAAA;AAAA;AAAA,gBADJ,eAWI;AAAA,iCACC;AAAA,sBAAI,KAAKuD,OAAL;AAAJ;AAAA;AAAA;AAAA;AAAA;AADD;AAAA;AAAA;AAAA;AAAA,gBAXJ,eAcI;AAAK,UAAA,SAAS,EAAC,QAAf;AAAA,kCACI;AACI,YAAA,SAAS,EAAC,cADd;AAEI,YAAA,IAAI,EAAC,OAFT;AAGI,YAAA,GAAG,EAAC,GAHR;AAII,YAAA,GAAG,EAAC,KAJR;AAKI,YAAA,IAAI,EAAC,MALT;AAMI,YAAA,KAAK,EAAE,KAAKD,WAAL,EANX;AAOI,YAAA,QAAQ,EAAE1E,CAAC,IAAI,KAAKuE,UAAL,CAAgBvE,CAAhB;AAPnB;AAAA;AAAA;AAAA;AAAA,kBADJ,eAUI;AAAQ,YAAA,SAAS,EAAC;AAAlB;AAAA;AAAA;AAAA;AAAA,kBAVJ;AAAA;AAAA;AAAA;AAAA;AAAA,gBAdJ;AAAA;AAAA;AAAA;AAAA;AAAA,cAzBX,eAqDW;AAAK,QAAA,SAAS,EAAC,KAAf;AAAA,+BACI;AAAK,UAAA,SAAS,EAAC,EAAf;AAAA,kCACC;AAAQ,YAAA,SAAS,EAAC,MAAlB;AAAyB,YAAA,IAAI,EAAC,QAA9B;AAAuC,YAAA,OAAO,EAAEA,CAAC,IAAI,KAAKgE,aAAL,CAAmBhE,CAAnB,CAArD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADD,eAEK;AAAG,YAAA,SAAS,EAAC,MAAb;AAAA,mCAA+B,KAAKG,KAAL,CAAWwC,GAAX,GAAe,CAAhB,GAAoB,KAAKxC,KAAL,CAAWwC,GAA/B,GAAqC,MAAI,KAAKxC,KAAL,CAAWwC,GAAlF;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFL,eAGC;AAAQ,YAAA,SAAS,EAAC,MAAlB;AAAyB,YAAA,IAAI,EAAC,QAA9B;AAAuC,YAAA,OAAO,EAAE3C,CAAC,IAAI,KAAKiE,aAAL,CAAmBjE,CAAnB,CAArD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAHD;AAAA;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,cArDX,eA6DW;AAAK,QAAA,SAAS,EAAC,KAAf;AAAA,+BACI;AAAK,UAAA,SAAS,EAAC,EAAf;AAAA,kCACC;AAAQ,YAAA,SAAS,EAAC,MAAlB;AAAyB,YAAA,IAAI,EAAC,QAA9B;AAAuC,YAAA,OAAO,EAAEA,CAAC,IAAI,KAAKmE,aAAL,CAAmBnE,CAAnB,CAArD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADD,eAEK;AAAG,YAAA,SAAS,EAAC,MAAb;AAAA,mCAA8ByE,UAAU,CAAC,KAAKtE,KAAL,CAAW2C,KAAZ,CAAV,CAA6BoD,OAA7B,CAAqC,CAArC,CAA9B;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFL,eAGC;AAAQ,YAAA,SAAS,EAAC,MAAlB;AAAyB,YAAA,IAAI,EAAC,QAA9B;AAAuC,YAAA,OAAO,EAAElG,CAAC,IAAI,KAAKsE,aAAL,CAAmBtE,CAAnB,CAArD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAHD;AAAA;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,cA7DX,eAqEW;AAAK,QAAA,SAAS,EAAC,KAAf;AAAA,+BACC;AAAA,iCACC;AAAU,YAAA,IAAI,EAAC,IAAf;AAAoB,YAAA,IAAI,EAAC,IAAzB;AAA8B,YAAA,WAAW,EAAC;AAA1C;AAAA;AAAA;AAAA;AAAA;AADD;AAAA;AAAA;AAAA;AAAA;AADD;AAAA;AAAA;AAAA;AAAA,cArEX,eA0EW;AAAK,QAAA,SAAS,EAAC,KAAf;AAAA,gCACI;AAAA,iCACI;AAAQ,YAAA,IAAI,EAAC,QAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,gBADJ,eAII;AAAK,UAAA,SAAS,EAAC,KAAf;AAAA,kCACI;AAAA,sBAAI,KAAKwF,aAAL;AAAJ;AAAA;AAAA;AAAA;AAAA,kBADJ,eAEI;AAAM,YAAA,QAAQ,EAAE,KAAKzF,YAArB;AAAA,oCACI;AAAA,qCAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAH;AAAA;AAAA;AAAA;AAAA,oBADJ,eAEI;AACI,cAAA,IAAI,EAAC,MADT;AAEI,cAAA,KAAK,EAAE,KAAKI,KAAL,CAAWC,IAFtB;AAGI,cAAA,QAAQ,EAAEJ,CAAC,IAAI,KAAKU,QAAL,CAAc;AAAEN,gBAAAA,IAAI,EAAEJ,CAAC,CAACa,MAAF,CAAS2C;AAAjB,eAAd;AAHnB;AAAA;AAAA;AAAA;AAAA,oBAFJ,eAOI;AAAQ,cAAA,IAAI,EAAC,QAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAPJ;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFJ,eAWI;AAAA,sBAAIkC;AAAJ;AAAA;AAAA;AAAA;AAAA,kBAXJ;AAAA;AAAA;AAAA;AAAA;AAAA,gBAJJ;AAAA;AAAA;AAAA;AAAA;AAAA,cA1EX;AAAA;AAAA;AAAA;AAAA;AAAA,YAFD;AAkGF;;AAncoC;;AAuctC,eAAevG,OAAf","sourcesContent":["import FilenameLabel from'./FilenameLabel.jsx';\nimport TrackControls from'./TrackControls.jsx';\nimport ErrorAlert from'./ErrorAlert.jsx';\n\nconst EventEmitter = require('events').EventEmitter;\nconst React = require('react');\nconst AudioPlayer = require('./../lib/AudioPlayer');\n\nclass Karaoke extends React.Component {\n\n\tconstructor(props) {\n        super(props);\n\n        this.state = {\n            action: 'stop',\n            duration: undefined,\n            error: undefined,\n            filename: undefined,\n            pitch: 1.0,\n            key: 0,\n            simpleFilter: undefined,\n            status: [],\n            t: 0,\n            tempo: 1.0,\n\n            response: [],\n            post: '',\n            responseToPost: '',\n        };\n\n        this.emitter = new EventEmitter();\n        this.emitter.on('state', state => this.setState(state));\n        this.emitter.on('status', status => {\n            if (status === 'Done!') {\n                this.setState({status: []});\n            } else {\n                this.setState({status: this.state.status.concat(status)});\n            }\n        });\n        this.emitter.on('stop', () => this.stop());\n\n        this.audioPlayer = new AudioPlayer({\n            emitter: this.emitter,\n            pitch: this.state.pitch,\n            tempo: this.state.tempo,\n        });\n\n        this.inputRef = React.createRef();\n    }\n\n    play() {\n        if (this.state.action !== 'play') {\n            this.audioPlayer.play();\n            this.setState({action: 'play'});\n        }\n    }\n\n    pause() {\n        if (this.state.action === 'play') {\n            this.audioPlayer.pause();\n            this.setState({action: 'pause'});\n        }\n    }\n\n    stop() {\n        this.pause();\n        this.audioPlayer.seekPercent(0);\n        this.setState({action: 'stop', t: 0});\n    }\n\n    handleFileChange(e) {\n        console.log(e);\n        if (e.target.files.length > 0) {\n            this.stop();\n\n            this.emitter.emit('status', 'Reading file...');\n            this.emitter.emit('state', {\n                error: undefined,\n                filename: undefined,\n            });\n\n            // http://stackoverflow.com/q/4851595/786644\n            const filename = e.target.value.replace('C:\\\\fakepath\\\\', '');\n            this.emitter.emit('state', {filename});\n\n            const file = e.target.files[0];\n\n            const reader = new FileReader();\n            reader.readAsArrayBuffer(file);\n            reader.onload = async event => {\n                this.emitter.emit('status', 'Playing file...');\n\n                let buffer;\n                try {\n                    buffer = await this.audioPlayer.decodeAudioData(event.target.result);\n                } catch (err) {\n                    this.emitter.emit('state', {\n                        error: {\n                            message: err.message,\n                            type: 'Decoding error',\n                        },\n                    });\n                    return;\n                }\n\n\n                this.audioPlayer.setBuffer(buffer);\n                this.play();\n            };\n        }\n    }\n\n    //https://prgomez.com/why-do-re-mi/\n\n    getPitchValue(val) {\n    \tvar num = 0;\n    \tvar s_var = (val>=0)?(parseInt(val)):(12+parseInt(val));\n    \tswitch(s_var){\n    \t\tcase 0 : \n    \t\t\tnum = 1;\n    \t\t\tbreak;\n    \t\tcase 1 : \n    \t\t\tnum = 1.059;\n    \t\t\tbreak;\n    \t\tcase 2 : \n    \t\t\tnum = 1.122;\n    \t\t\tbreak;\n    \t\tcase 3 : \n    \t\t\tnum = 1.189;\n    \t\t\tbreak;\n    \t\tcase 4 : \n    \t\t\tnum = 1.26;\n    \t\t\tbreak;\n    \t\tcase 5 : \n    \t\t\tnum = 1.335;\n    \t\t\tbreak;\n    \t\tcase 6 : \n    \t\t\tnum = 1.414;\n    \t\t\tbreak;\n    \t\tcase 7 : \n    \t\t\tnum = 1.498;\n    \t\t\tbreak;\n    \t\tcase 8 : \n    \t\t\tnum = 1.587;\n    \t\t\tbreak;\n    \t\tcase 9 : \n    \t\t\tnum = 1.682;\n    \t\t\tbreak;\n    \t\tcase 10 : \n    \t\t\tnum = 1.782;\n    \t\t\tbreak;\n    \t\tcase 11 : \n    \t\t\tnum = 1.888;\n    \t\t\tbreak;\n    \t\tcase 12 : \n    \t\t\tnum = 2;\n    \t\t\tbreak;\n    \t\tdefault : \n    \t\t\tnum = 1;\n    \t\t\tbreak;\n    \t}\n        const pitch = (val>=0)?(num):(num/2);\n        return pitch;\n    }\n    handlePitchChange(e) {\n        const pitch = this.getPitchValue(e.target.value);\n        this.audioPlayer.pitch = pitch;\n        this.setState({pitch});\n    }\n    \n    decreasePitch(e){\n    \tif(this.state.pitch > 0.5 && this.state.pitch <= 2){\n    \t\tconst key = this.state.key-1;\n    \t\tconst pitch = this.getPitchValue(key);\n\n\t        this.audioPlayer.pitch = pitch;\n\t        this.setState({key});\n\t        this.setState({pitch});\n    \t}\n    }\n\n    increasePitch(e){\n    \tif(this.state.pitch >= 0.5 && this.state.pitch < 2){\n    \t\tconst key = this.state.key+1;\n    \t\tconst pitch = this.getPitchValue(key);\n\n\t        this.audioPlayer.pitch = pitch;\n\t        this.setState({key});\n\t        this.setState({pitch});\n    \t}\n    }\n\n    handleTempoChange(e) {\n        const tempo = e.target.value;\n        this.audioPlayer.tempo = tempo;\n        this.setState({tempo});\n    }\n\n    decreaseTempo(e) {\n    \tif(this.state.tempo > 0.5 && this.state.tempo <= 2){\n    \t\tconst tempo = +(Math.round(this.state.tempo-0.1 + \"e+2\")  + \"e-2\");\n\t        this.audioPlayer.tempo = tempo;\n\t        this.setState({tempo});\n    \t}\n    }\n\n    increaseTempo(e) {\n        if(this.state.tempo >= 0.5 && this.state.tempo < 2){\n    \t\tconst tempo = +(Math.round(this.state.tempo+0.1 + \"e+2\")  + \"e-2\");\n\t        this.audioPlayer.tempo = tempo;\n\t        this.setState({tempo});\n    \t}\n    }\n\n    handleSeek(e) {\n        const percent = parseFloat(e.target.value);\n        this.audioPlayer.seekPercent(percent);\n        this.play();\n    }\n\n    percentDone() {\n        if (!this.state.duration) {\n            return 0;\n        }\n\n        return this.state.t / this.state.duration * 100;\n    }\n\n    getTime(){\n        var result = \"\";\n        if(this.state.duration!=null){\n\n            var cur_tempo = this.state.tempo;\n\n            var whole = this.state.duration/cur_tempo;\n            var whole_min = Math.floor(whole/60);\n            var whole_sec = Math.floor(whole-whole_min*60);\n\n            var current = this.state.t/cur_tempo;\n            var cur_min = Math.floor(current/60);\n            var cur_sec = Math.floor(current-cur_min*60);\n\n\n\n            result += ((cur_min<10)?(\"0\"+cur_min):(cur_min))+\":\"+((cur_sec<10)?(\"0\"+cur_sec):(cur_sec));\n            result += \"/\";\n            result += ((whole_min<10)?(\"0\"+whole_min):(whole_min))+\":\"+((whole_sec<10)?(\"0\"+whole_sec):(whole_sec));\n        }\n    \treturn result;\n    }\n\n    componentDidMount() {\n        this.callApi()\n            .then(\n                res => {\n                    for(var i=0;i<res.music.length;i++){\n                        this.setState({ response : this.state.response.concat(res.music[i].filename) });\n                    }\n                }\n            )\n            .catch(err => console.log(err));\n    }\n      \n    callApi = async () => {\n        const response = await fetch('/api/files');\n        const body = await response.json();\n        if (response.status !== 200) throw Error(body.message);\n        return body;\n    };\n\n    handleSubmit = async e => {\n        e.preventDefault();\n        var filename = this.state.post;\n        const response = await fetch('/api/world', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({ post: this.state.post }),\n        });\n        const body = await response.text();\n\n        this.setState({ responseToPost: body });\n    };\n\n    printResponse(){\n        var result = \"\";\n        for(var i=0; i< this.state.response.length; i++){\n            result += this.state.response[i]+\"\\n\";\n        }\n        return result;\n    }\n\n    getMusic = async e => {\n        e.preventDefault();\n        var filename = e.target.outerText;\n        var url = '/api/mp3?file='+filename;\n        const response = await fetch( url, {\n            method: 'GET',\n            headers: {},\n        }).then(function (response) {\n                    return response.blob();\n                }\n            )\n            .then(function(blob) {\n                console.log(this);\n                this.stop();\n\n                this.emitter.emit('status', 'Reading file...');\n                this.emitter.emit('state', {\n                    error: undefined,\n                    filename: undefined,\n                });\n\n                // http://stackoverflow.com/q/4851595/786644\n                this.emitter.emit('state', {filename});\n\n                const file = blob;\n\n                const reader = new FileReader();\n                reader.readAsArrayBuffer(file);\n                reader.onload = async event => {\n                    this.emitter.emit('status', 'Playing file...');\n\n                    let buffer;\n                    try {\n                        buffer = await this.audioPlayer.decodeAudioData(event.target.result);\n                    } catch (err) {\n                        this.emitter.emit('state', {\n                            error: {\n                                message: err.message,\n                                type: 'Decoding error',\n                            },\n                        });\n                        return;\n                    }\n\n\n                    this.audioPlayer.setBuffer(buffer);\n                    this.play();\n                };\n            })\n            .catch(error => {\n                //whatever\n            })\n        //const body = await response.json();\n        //console.log(body);\n        //this.setState({ responseToPost: body });\n    }\n\n    \n\n\trender (){\n\n        const items = [];\n\n        for(const [index, value] of this.state.response.entries()){\n            items.push(<li key={index} onClick={e => this.getMusic(e)}>{value}</li>);\n        }\n\n\n\t  \treturn (\n\n\t  \t\t<div className=\"Karaoke\">\n\t  \t\t  <div className=\"row title_header alert alert-info\">\n\t  \t\t  \tKaraoke\n\t  \t\t  </div>\n\n\t\t      <div className=\"row\" style={{marginBottom: '1em'}}>\n                    <label\n                        className=\"btn btn-primary btn-lg\"\n                        htmlFor=\"sas-file\"\n                        style={{marginRight: '0.25em'}}\n                    >\n                        <input\n                            id=\"sas-file\"\n                            accept=\"audio\"\n                            type=\"file\"\n                            style={{display: 'none'}}\n                            onChange={e => this.handleFileChange(e)}\n                        />\n                        Select MP3\n                    </label>\n                    <FilenameLabel error={this.state.error} filename={this.state.filename} />\n                </div>\n\n                <ErrorAlert error={this.state.error} />\n\n                <div className=\"row\">\n                    <div className=\"\" style={{paddingTop: '6px'}}>\n                    \t<TrackControls\n                            action={this.state.action}\n                            error={this.state.error}\n                            filename={this.state.filename}\n                            onPlay={() => this.play()}\n                            onPause={() => this.pause()}\n                            onStop={() => this.stop()}\n                        />\n                    </div>\n                    <div>\n                    \t<p>{this.getTime()}</p>\n                    </div>\n                    <div className=\"ranger\">\n                        <input\n                            className=\"form-control\"\n                            type=\"range\"\n                            min=\"0\"\n                            max=\"100\"\n                            step=\"0.05\"\n                            value={this.percentDone()}\n                            onChange={e => this.handleSeek(e)}\n                        />\n                        <output className=\"bubble\"></output>\n                    </div>\n                </div>\n\n                <div className=\"row\">\n                   \t<div className=\"\">\n                   \t\t<button className=\"btns\" type=\"button\" onClick={e => this.decreasePitch(e)}> down </button>\n\t                        <p className=\"tagg\"> Pitch ({ (this.state.key<0)?(this.state.key):(\"+\"+this.state.key) } key) </p>\n                    \t<button className=\"btns\" type=\"button\" onClick={e => this.increasePitch(e)}> up </button>\n                    </div>\n                </div>\n\n                <div className=\"row\">\n                    <div className=\"\">\n                    \t<button className=\"btns\" type=\"button\" onClick={e => this.decreaseTempo(e)}> slow </button>\n\t                        <p className=\"tagg\"> Tempo ({ parseFloat(this.state.tempo).toFixed(1) }x) </p>\n                    \t<button className=\"btns\" type=\"button\" onClick={e => this.increaseTempo(e)}> fast </button>\n                    </div>\n                </div>\n\n                <div className=\"row\">\n                \t<div>\n                \t\t<textarea rows=\"20\" cols=\"30\" placeholder=\"write the lyrics here...\"></textarea>\n                    </div>\n                </div>\n                <div className=\"row\">\n                    <div>\n                        <button type=\"button\" > get mp3 </button>\n                    </div>\n                    <div className=\"row\">\n                        <p>{this.printResponse()}</p>\n                        <form onSubmit={this.handleSubmit}>\n                            <p><strong>Post to Server:</strong></p>\n                            <input\n                                type=\"text\"\n                                value={this.state.post}\n                                onChange={e => this.setState({ post: e.target.value })}\n                            />\n                            <button type=\"submit\">Submit</button>\n                        </form>\n                        <p>{items}</p>\n                    </div> \n                </div>\n\n\t\t    </div>\n\n\t    )\n\t}\n\n}\n\nexport default Karaoke;\n"]},"metadata":{},"sourceType":"module"}